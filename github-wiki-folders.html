<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/iron-ajax/iron-ajax.html">

<dom-module id="github-wiki-folders">

  <template>
    <iron-ajax
      auto
      url="https://api.github.com/repos/Flow42/greennav.github.io/contents/wiki"
      handle-as="json"
      on-response="handleResponse"
      debounce-duration="300"></iron-ajax>

     <template is="dom-repeat" items="{{ folders }}">
      	<paper-submenu>
      		<paper-item class="menu-trigger">{{ item.name }}</paper-item>
      			<github-markdown-files files="{{ files }}" selected="{{ selected }}" url={{item.address}}></github-markdown-files>
      	</paper-submenu>
	</template>
     
      
  </template>

    
</dom-module>

<script>

  Polymer({

    is: 'github-wiki-folders',

    properties: {
      folders: {
        type: Array,
        notify: true
      },
      selected: {
        type: Array,
        notify: true
      }
    },

    handleResponse: function(request) {
      this.set('folders', []);

      for (var i = 0; i < request.detail.response.length; i++) {
        var file = request.detail.response[i]

        if (file.type==="dir") {
          this.unshift('folders', { 
          	name: file.name,
            address: file.url            
            });
        }
      };
    }

  });

</script>