<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="bower_components/iron-ajax/iron-ajax.html">

<dom-module id="github-markdown-files">

  <template>
    <iron-ajax
      auto
      url="{{url}}"
      handle-as="json"
      on-response="handleResponse"
      debounce-duration="300"></iron-ajax>
     
      <paper-menu class="menu-content" selected="{{ selected }}" attr-for-selected="element">
        <template is="dom-repeat" items="{{ files }}">
          <a href="{{ item.link }}">
            <paper-icon-button icon="create"></paper-icon-button>
          </a>
          <paper-item element="{{ item }}">
            <paper-button>{{ item.name }}</paper-button>
          </paper-item>
          <br>              
        </template>           
      </paper-menu>
           

  </template>

</dom-module>

<script>

  Polymer({

    is: 'github-markdown-files',

    properties: {
      files: {
        type: Array,
        notify: true
      },
      selected: {
        type: Array,
        notify: true
      },
      url : String
    },

    handleResponse: function(request) {
      this.set('files', []);

      for (var i = 0; i < request.detail.response.length; i++) {
        var file = request.detail.response[i]

        if (file.name.endsWith(".md")) {
          this.unshift('files', { 
            name: file.name.replace('.md', ''), 
            path: file.download_url, 
            link: file.html_url
            });
        }
      };
    }

  });

</script>